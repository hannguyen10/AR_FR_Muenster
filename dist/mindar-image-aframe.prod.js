(()=>{var e={2792:function(e){e.exports=function(){"use strict";var e=function(){var t=0,i=document.createElement("div");function n(e){return i.appendChild(e.dom),e}function a(e){for(var n=0;n<i.children.length;n++)i.children[n].style.display=n===e?"block":"none";t=e}i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),a(++t%i.children.length)}),!1);var s=(performance||Date).now(),r=s,o=0,l=n(new e.Panel("FPS","#0ff","#002")),h=n(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new e.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:i,addPanel:n,showPanel:a,begin:function(){s=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(h.update(e-s,200),r+1e3<=e&&(l.update(1e3*o/(e-r),100),r=e,o=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:i,setMode:a}};return e.Panel=function(e,t,i){var n=1/0,a=0,s=Math.round,r=s(window.devicePixelRatio||1),o=80*r,l=48*r,h=3*r,c=2*r,d=3*r,u=15*r,m=74*r,p=30*r,f=document.createElement("canvas");f.width=o,f.height=l,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*r+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,o,l),g.fillStyle=t,g.fillText(e,h,c),g.fillRect(d,u,m,p),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(d,u,m,p),{dom:f,update:function(l,v){n=Math.min(n,l),a=Math.max(a,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,o,u),g.fillStyle=t,g.fillText(s(l)+" "+e+" ("+s(n)+"-"+s(a)+")",h,c),g.drawImage(f,d+r,u,m-r,p,d,u,m-r,p),g.fillRect(d+m-r,u,r,p),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(d+m-r,u,r,s((1-l/v)*p))}}},e}()}},t={};function i(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e="arError",t="image-markerFound",n="image-markerLost",a="mindar-image-system";AFRAME.registerComponent("mindar-image",{dependencies:[a],el:null,schema:{imageTargetSrc:{type:"string"},maxTrack:{type:"int",default:1},filterMinCF:{type:"number",default:-1},filterBeta:{type:"number",default:-1},missTolerance:{type:"int",default:-1},warmupTolerance:{type:"int",default:-1},showStats:{type:"boolean",default:!1},autoStart:{type:"boolean",default:!0},uiLoading:{type:"string",default:"yes"},uiScanning:{type:"string",default:"yes"},uiError:{type:"string",default:"yes"},reshowScanning:{type:"boolean",default:!0},shouldFaceUser:{type:"boolean",default:!1}},init:function(){if(!this.el.sceneEl)return;const e=this.el.sceneEl.systems["mindar-image-system"];e.setup({imageTargetSrc:this.data.imageTargetSrc,maxTrack:this.data.maxTrack,filterMinCF:-1===this.data.filterMinCF?null:this.data.filterMinCF,filterBeta:-1===this.data.filterBeta?null:this.data.filterBeta,missTolerance:-1===this.data.missTolerance?null:this.data.missTolerance,warmupTolerance:-1===this.data.warmupTolerance?null:this.data.warmupTolerance,showStats:this.data.showStats,uiLoading:this.data.uiLoading,uiScanning:this.data.uiScanning,uiError:this.data.uiError,reshowScanning:this.data.reshowScanning,shouldFaceUser:this.data.shouldFaceUser}),this.data.autoStart&&this.el.sceneEl.addEventListener("renderstart",(()=>{e.start()}))}}),AFRAME.registerComponent("mindar-image-target",{dependencies:[a],el:null,postMatrix:null,schema:{targetIndex:{type:"number"}},init:function(){if(!this.el.sceneEl)return;this.el.sceneEl.systems["mindar-image-system"].registerAnchor(this,this.data.targetIndex);const e=this.el.object3D;e.visible=!1,e.matrixAutoUpdate=!1},setupMarker([e,t]){const i=new AFRAME.THREE.Vector3,n=new AFRAME.THREE.Quaternion,a=new AFRAME.THREE.Vector3;i.x=e/2,i.y=e/2+(t-e)/2,a.x=e,a.y=e,a.z=e,this.postMatrix=new AFRAME.THREE.Matrix4,this.postMatrix.compose(i,n,a)},updateWorldMatrix(e){if(!this.el.object3D.visible&&e?this.el.emit(t):this.el.object3D.visible&&!e&&this.el.emit(n),this.el.object3D.visible=!!e,!e)return;const i=new AFRAME.THREE.Matrix4;i.elements=e,i.multiply(this.postMatrix),this.el.object3D.matrix=i}});var s=i(2792),r=i.n(s);const{Controller:o,UI:l}=window.MINDAR.IMAGE;AFRAME.registerSystem(a,{container:null,video:null,anchorEntities:[],imageTargetSrc:"",maxTrack:-1,filterMinCF:-1/0,filterBeta:1/0,missTolerance:-1/0,warmupTolerance:-1/0,showStats:!1,controller:null,ui:null,el:null,mainStats:null,reshowScanning:!0,shouldFaceUser:!1,init:function(){this.anchorEntities=[]},setup:function({imageTargetSrc:e,maxTrack:t,showStats:i,uiLoading:n,uiScanning:a,uiError:s,missTolerance:r,warmupTolerance:o,filterMinCF:h,filterBeta:c,reshowScanning:d,shouldFaceUser:u}){this.imageTargetSrc=e,this.maxTrack=t,this.filterMinCF=h,this.filterBeta=c,this.missTolerance=r,this.warmupTolerance=o,this.showStats=i,this.reshowScanning=d,this.shouldFaceUser=u,this.ui=new l({uiLoading:n,uiScanning:a,uiError:s}),this._registerEventListener()},_registerEventListener:function(){this.el.addEventListener(t,(()=>{this.ui.hideScanning()})),this.el.addEventListener(n,(()=>{this.reshowScanning&&this.ui.showScanning()}))},registerAnchor:function(e,t){this.anchorEntities.push({el:e,targetIndex:t})},start:function(){this.el.sceneEl&&this.el.sceneEl.parentNode&&(this.container=this.el.sceneEl.parentNode,this.showStats&&(this.mainStats=new(r()),this.mainStats.showPanel(0),this.mainStats.domElement.style.cssText="position: absolute; top: 0px; left: 0px; z-index: 999",this.container.appendChild(this.mainStats.domElement)),this.ui.showLoading(),this._startVideo())},switchTarget:function(e){this.controller.interestedTargetIndex=e},stop:function(){if(this.pause(),!this.video)return;const{srcObject:e}=this.video;e&&(e.getTracks().forEach((function(e){e.stop()})),this.video.remove())},switchCamera:function(){this.shouldFaceUser=!this.shouldFaceUser,this.stop(),this.start()},pause:function(e=!1){e||this.video.pause(),this.controller.stopProcessVideo()},unpause:function(){this.video.play(),this.controller.processVideo(this.video)},_startVideo:async function(){if(this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this.video.style.position="absolute",this.video.style.top="0px",this.video.style.left="0px",this.video.style.zIndex="-2",this.container.appendChild(this.video),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return this.el.emit(e,{error:"VIDEO_FAIL"}),void this.ui.showCompatibility();try{const e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));let t="environment";e.length>1&&(t=this.shouldFaceUser?"user":"environment");const i=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:t}});this.video.addEventListener("loadedmetadata",(()=>{this.video.setAttribute("width",this.video.videoWidth.toString()),this.video.setAttribute("height",this.video.videoHeight.toString()),this._startAR()})),this.video.srcObject=i}catch(t){console.log("getUserMedia error",t),this.el.emit(e,{error:"VIDEO_FAIL"})}},_startAR:async function(){this.controller=new o({inputWidth:this.video.videoWidth,inputHeight:this.video.videoHeight,maxTrack:this.maxTrack,filterMinCF:this.filterMinCF,filterBeta:this.filterBeta,missTolerance:this.missTolerance,warmupTolerance:this.warmupTolerance,onUpdate:e=>{switch(e.type){case"processDone":this.mainStats&&this.mainStats.update();break;case"updateMatrix":const{targetIndex:t,worldMatrix:i}=e;for(const e of this.anchorEntities)e.targetIndex===t&&e.el.updateWorldMatrix(i)}}}),this._resize(),window.addEventListener("resize",this._resize.bind(this));const{dimensions:e}=await this.controller.addImageTargets(this.imageTargetSrc);for(const t of this.anchorEntities){const{el:i,targetIndex:n}=t;n<e.length&&i.setupMarker(e[n])}await this.controller.dummyRun(this.video),this.el.emit("arReady"),this.ui.hideLoading(),this.ui.showScanning(),this.controller.processVideo(this.video)},_resize:function(){const{vh:e}=((e,t)=>{let i,n;const a=e.videoWidth/e.videoHeight;return a>t.clientWidth/t.clientHeight?(n=t.clientHeight,i=n*a):(i=t.clientWidth,n=i/a),e.style.top=-(n-t.clientHeight)/2+"px",e.style.left=-(i-t.clientWidth)/2+"px",e.style.width=i+"px",e.style.height=n+"px",{vw:i,vh:n}})(this.video,this.container),t=this.container,i=this.controller.getProjectionMatrix(),n=2*Math.atan(1/i[5]/e*t.clientHeight)*180/Math.PI,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),r=t.clientWidth/t.clientHeight,o=t.getElementsByTagName("a-camera")[0].getObject3D("camera");o.fov=n,o.aspect=r,o.near=a,o.far=s,o.updateProjectionMatrix()}})})()})();